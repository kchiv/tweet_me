{% extends 'base.html' %}

{% block title %}All Tweets {{ block.super }}{% endblock title %}

{% block script %}

<script>
	
$(document).ready(function(){
	console.log("working");

	$.ajax({
		url: "/api/tweet/",
		method: "GET",
		success: function(data){
			$.each(data, function(key, value){
				var tweetKey = key;
				var tweetContent = value.content;
				var tweetUser = value.user;
				$("#tweet-container").append(
					"<div class=\"row\"><div class=\"col-sm-3 col-xs-12\"><h1>" + tweetUser.username + "</h1></div><div class=\"col-sm-9\"><p>" + tweetContent + "</p><p>via " + tweetUser.username + " | <a href='#'>View</a></p>" + "</div><div class=\"col-sm-12\"><hr></div>"
				)
			})
		},
		error: function(data){
			console.log("error")
			console.log(data)
		}
	})

});

</script>

{% endblock script %}

{% block content %}

	{% if not request.GET.q %}
		<div class="row">
			<div class="col-sm-9 offset-sm-3">
				{% include 'tweets/form.html' with form=create_form action_url=create_url btn_title='Tweet' %}
			</div>
		</div>
		<hr>
	{% endif %}

	<div id="tweet-container">
		
	</div>

	{% for obj in object_list %}

		<div class="row">
			<div class="col-sm-3 col-xs-12">
				<h1>{{ obj.user }}</h1>
			</div>
			<div class="col-sm-9">
				<p>{{ obj.content }}</p>
				<p>via {{ obj.user }} | {{ obj.timestamp|timesince }} ago | <a href="{{ obj.get_absolute_url }}">View</a></p>
			</div>
			<div class="col-sm-12">
				<hr>
			</div>
		</div>

	{% empty %}
		{% if request.GET.q %}
		<p>No tweets found.</p>
		{% else %}
		<p>No tweets yet.</p>
		{% endif %}

	{% endfor %}

{% endblock content %}